<!-- chat.component.html -->
<div class="flex h-screen bg-gray-900 text-gray-100">
  <!-- Lista de chats -->
  <div class="w-1/3 border-r border-gray-700 flex flex-col">
    <div class="p-4 bg-gray-800 border-b border-gray-700">
      <h2 class="text-xl font-bold">Conversaciones</h2>
    </div>
    
    <div class="flex-1 overflow-y-auto">
      <div *ngFor="let chat of chats" 
           (click)="selectChat(chat)"
           [class.bg-gray-800]="selectedChat?.id === chat.id"
           class="p-4 border-b border-gray-700 hover:bg-gray-800 cursor-pointer">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="font-semibold">{{ getChatName(chat) }}</h3>
            <p class="text-sm text-gray-400 truncate">{{ chat.lastMessage }}</p>
          </div>
          <div *ngIf="chat.unread > 0" 
               class="bg-blue-500 text-white rounded-full px-2 py-1 text-xs">
            {{ chat.unread }}
          </div>
        </div>
        <p class="text-xs text-gray-500 mt-1">
          {{ formatDate(chat.lastMessageDate) }}
        </p>
      </div>
    </div>
  </div>

  <!-- Ventana de chat -->
  <div class="flex-1 flex flex-col">
    <!-- Encabezado -->
    <div *ngIf="selectedChat" class="p-4 bg-gray-800 border-b border-gray-700">
      <h3 class="text-lg font-semibold">{{ getChatName(selectedChat) }}</h3>
    </div>

    <!-- Mensajes -->
    <div class="flex-1 overflow-y-auto p-4 message-container" (scroll)="onScroll($event)">
      <!-- Indicador de carga -->
      <div *ngIf="loadingMessages" class="text-center p-4 text-gray-400">
        <i class="fas fa-spinner fa-spin"></i> Cargando mensajes...
      </div>

      <!-- Lista de mensajes -->
      <div *ngFor="let message of messages" 
           [class.justify-end]="isCurrentUser(message.remitenteId)"
           class="flex gap-3 mb-4">
        
        <!-- Avatar remitente -->
        <div *ngIf="!isCurrentUser(message.remitenteId)" class="flex-shrink-0">
          <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center">
            <i class="fas fa-user text-gray-400"></i>
          </div>
        </div>

        <!-- Contenido del mensaje -->
        <div [class.bg-blue-600]="isCurrentUser(message.remitenteId)"
             class="max-w-[70%] p-3 rounded-lg bg-gray-800">
          <p class="text-gray-100">{{ message.contenido }}</p>
          <div class="flex items-center justify-end gap-1 mt-1">
            <p class="text-xs text-gray-400">
              {{ formatDate(message.fechaEnvio) }}
            </p>
            <i *ngIf="message.leido" class="fas fa-check-double text-xs text-blue-400"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Input de mensaje -->
    <div *ngIf="selectedChat" class="p-4 border-t border-gray-700">
      <div class="flex gap-2">
        <input [(ngModel)]="newMessage" 
               (keyup.enter)="sendMessage()"
               placeholder="Escribe un mensaje..."
               class="flex-1 bg-gray-800 rounded-lg px-4 py-2 text-gray-100 
                      focus:outline-none focus:ring-2 focus:ring-blue-500">
        <button (click)="sendMessage()"
                class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg 
                       text-white transition-colors">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>

    <!-- Sin chat seleccionado -->
    <div *ngIf="!selectedChat" class="flex-1 flex items-center justify-center">
      <p class="text-gray-400">Selecciona un chat para comenzar</p>
    </div>
  </div>
</div>